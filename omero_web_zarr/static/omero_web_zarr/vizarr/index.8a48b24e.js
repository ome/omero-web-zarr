var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,i=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&l(e,n,t[n]);return e},s=(e,a)=>t(e,n(a));import{X as c,C as m,p as u,S as d,T as p,o as h,a as f,b as g,Z as y,M as w,H as x,c as E,G as b,D as v,d as _,I as P,e as A,s as S,w as I,f as C,u as O,R as k,g as z,r as F,h as j,O as M,i as $,V as L,j as V,k as R,A as N,l as T,m as B,N as D,n as q,P as W,q as U,t as G,v as H,x as J,y as Z,z as X,L as Y,B as K,E as Q,F as ee,J as te,K as ne,Q as ae,U as re,W as oe,Y as le,_ as ie,$ as se,a0 as ce}from"./vendor.32c7a866.js";let me;const ue={},de=function(e,t){if(!t||0===t.length)return e();if(void 0===me){const e=document.createElement("link").relList;me=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if((e=`./${e}`)in ue)return;ue[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":me,t||(a.as="script",a.crossOrigin=""),a.href=e,document.head.appendChild(a),t?new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("error",t)})):void 0}))).then((()=>e()))},pe=s(i({},c.defaultProps),{loaders:{type:"array",value:[],compare:!0},spacer:{type:"number",value:5,compare:!0},rows:{type:"number",value:0,compare:!0},columns:{type:"number",value:0,compare:!0},concurrency:{type:"number",value:10,compare:!1},text:{type:"boolean",value:!1,compare:!0},onClick:{type:"function",value:null,compare:!0},onHover:{type:"function",value:null,compare:!0}});function he(e,t,n=[0,0],a=1){const[r,o]=n;return[r,t*a+o,e*a+r,o]}function fe(e){const{loaders:t,loaderSelection:n=[]}=e;let{concurrency:a}=e;a&&n.length>0&&(a=Math.ceil(a/n.length));return u(t,(async e=>{const t=n.map((t=>e.loader.getRaster({selection:t}))),a=await Promise.all(t);return s(i({},e),{data:{data:a.map((e=>e.data)),width:a[0].width,height:a[0].height}})}),{concurrency:a})}class ge extends m{initializeState(){this.state={gridData:[],width:0,height:0},fe(this.props).then((e=>{const{width:t,height:n}=function(e){const[t]=e,{width:n,height:a}=t.data;return e.forEach((({data:e})=>{if((null==e?void 0:e.width)!==n||(null==e?void 0:e.height)!==a)throw new Error("Grid data is not same shape.")})),{width:n,height:a}}(e);this.setState({gridData:e,width:t,height:n})}))}updateState({props:e,oldProps:t,changeFlags:n}){const{propsChanged:a}=n,r="string"==typeof a&&a.includes("props.loaders"),o=e.loaderSelection!==t.loaderSelection;(r||o)&&fe(this.props).then((e=>{this.setState({gridData:e})}))}getPickingInfo({info:e}){if(!e.coordinate)return e;const t=this.props.spacer||0,{width:n,height:a}=this.state,[r,o]=e.coordinate,l=Math.floor(o/(a+t)),i=Math.floor(r/(n+t));return e.gridCoord={row:l,column:i},e}renderLayers(){const{gridData:e,width:t,height:n}=this.state;if(0===t||0===n)return null;const{rows:a,columns:r,spacer:o=0,id:l=""}=this.props,s=e.map((e=>{const a=e.row*(n+o),r=e.col*(t+o),s={channelData:e.data,bounds:he(t,n,[r,a]),id:`${l}-GridLayer-${e.row}-${e.col}`,dtype:e.loader.dtype||"Uint16",pickable:!1};return new c(i(i({},this.props),s))}));if(this.props.pickable){const[e,c]=[0,0],m=a*(n+o),u=r*(t+o),p={data:[{polygon:[[c,e],[u,e],[u,m],[c,m]]}],getPolygon:e=>e.polygon,getFillColor:[0,0,0,0],getLineColor:[0,0,0,0],pickable:!0,id:`${l}-GridLayer-picking`},h=new d(i(i({},this.props),p));s.push(h)}if(this.props.text){const a=new p({id:`${l}-GridLayer-text`,data:e,getPosition:e=>[e.col*(t+o),e.row*(n+o)],getText:e=>e.name,getColor:[255,255,255,255],getSize:16,getAngle:0,getTextAnchor:"start",getAlignmentBaseline:"top"});s.push(a)}return s}}ge.layerName="GridLayer",ge.defaultProps=pe;const ye={cyan:"#00FFFF",yellow:"#FFFF00",magenta:"#FF00FF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",white:"#FFFFFF"},we=[ye.magenta,ye.green],xe=[ye.red,ye.green,ye.blue],Ee=Object.values(ye).slice(0,-2);async function be(e){const t=await async function(e){if("string"==typeof e){let t;if(e.endsWith(".json")){const[{ReferenceStore:n},a]=await Promise.all([de((()=>import("./index.709bf6a3.js")),[]),fetch(e).then((e=>e.json()))]);t=n.fromJSON(a)}else t=new x(e);return t}return e}(e);return h(t).catch((e=>{if(e instanceof f)return g({store:t});throw e}))}async function ve(e,t){const{datasets:n}=t[0]||[{path:"0"}],a=await Promise.all(n.map((({path:t})=>e.getItem(t))));if(a.every((e=>e instanceof y)))return a;throw Error("Multiscales metadata included a path to a group.")}function _e(e){e.startsWith("#")&&(e=e.slice(1));return[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)]}function Pe(e){return Array.from({length:e},((e,t)=>t))}function Ae(...e){return e.filter(Boolean).map((e=>function(e,t=" "){for(;e.length>0&&t.includes(e.charAt(e.length-1));)e=e.substr(0,e.length-1);return e}(e,"/"))).join("/")}function Se(e){const t=e[e.length-1];return 3===t||4===t}function Ie(e){const t=Se(e.shape),[n,a]=e.chunks.slice(t?-3:-2),r=Math.min(n,a);return 2**Math.floor(Math.log2(r))}function Ce(e){if(!e)return new w;const t=new w;try{const a="string"==typeof e?JSON.parse(e):e;if(n=a,!Array.isArray(n)||16!==n.length||!n.every((e=>"number"==typeof e)))throw Error("Invalid modelMatrix size. Must be 16.");t.setRowMajor(...a)}catch{const t=`Failed to parse modelMatrix. Got ${JSON.stringify(e)}, using identity.`;console.warn(t)}var n;return t}async function Oe(e,t,n){var a,r;if(!("columns"in n)||!("rows"in n))throw Error("Plate .zattrs missing columns or rows");const o=n.rows.map((e=>e.name)),l=n.columns.map((e=>e.name)),c=n.wells.map((e=>e.path)),m=await t.getItem(c[0]).then((e=>e.attrs.asObject()));if(!("well"in m))throw Error("Path for image is not valid, not a well.");const d=m.well.images[0].path,p=await t.getItem(Ae(c[0],d)).then((e=>e.attrs.asObject()));if(!("omero"in p))throw Error("Path for image is not valid.");const{datasets:h}=p.multiscales[0],f=h[h.length-1].path,g=await u(c.map((e=>[e,Ae(e,d,f)])),(([e,n])=>t.getItem(n).then((t=>[e,t]))),{concurrency:10}),y=await Promise.all(g),w=ze(p.multiscales),b=ke(p.omero,w),v=Ie(y[0][1]),_=y.map((e=>{const[t,n]=e[0].split("/");return{name:`${t}${n}`,row:o.indexOf(t),col:l.indexOf(n),loader:new E(e[1],w,v)}})),P=s(i({loaders:_},b),{axis_labels:w,loader:[_[0].loader],model_matrix:Ce(e.model_matrix),defaults:{selection:b.defaultSelection,colormap:null!=(a=e.colormap)?a:"",opacity:null!=(r=e.opacity)?r:1},name:n.name||"Plate",rows:o.length,columns:l.length});return P.onClick=n=>{let a=n.gridCoord;if(!a)return;const{row:r,column:i}=a;let s;t.store instanceof x&&!isNaN(r)&&!isNaN(i)&&(s=Ae(t.store.url,o[r],l[i])),e.onClick?(delete n.layer,n.imageSource=s,e.onClick(n)):s&&window.open(window.location.origin+window.location.pathname+"?source="+s)},P}function ke({rdefs:e,channels:t,name:n},a){var r,o;const l=null!=(r=e.defaultT)?r:0,i=null!=(o=e.defaultZ)?o:0,s=[],c=[],m=[],u=[];t.forEach((e=>{s.push(e.color),c.push([e.window.start,e.window.end]),m.push(e.active),u.push(e.label)}));const d=a.map((e=>"t"==e?l:"z"==e?i:0));return{name:n,names:u,colors:s,contrast_limits:c,visibilities:m,channel_axis:a.includes("c")?a.indexOf("c"):null,defaultSelection:d}}function ze(e){return e[0].axes||["t","c","z","y","x"]}function Fe(e){const{loader:t,channel_axis:n,colors:a,visibilities:r,contrast_limits:o,model_matrix:l,defaults:i,loaders:s,rows:c,columns:m,onClick:u}=e,{selection:d,opacity:p,colormap:h}=i,f=function(e){return e.loaders?ge:e.loader.length>1?_:P}(e),g=[],y=[],w=[],x=[],E=r.flatMap(((e,t)=>e?t:[]));for(const v of E){if(Number.isInteger(n)){const e=[...d];e[n]=v,g.push(e)}else g.push(d);y.push(_e(a[v])),w.push(o[v]),x.push(!0)}const b=[...w];if(!(t[0].dtype in v))throw Error(`Dtype not supported, must be ${JSON.stringify(Object.keys(v))}`);return{Layer:f,layerProps:{loader:1===t.length?t[0]:t,loaders:s,rows:c,columns:m,loaderSelection:g,colorValues:y,sliderValues:b,contrastLimits:w,channelIsOn:x,opacity:p,colormap:h,modelMatrix:l,onClick:u},on:!0}}var je=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createSourceData:async function(e){var t;const n=await be(e.source);let a;if(n instanceof b){const t=await n.attrs.asObject();if("plate"in t)return Oe(e,n,t.plate);if("well"in t)return async function(e,t,n){var a,r,o,l;const c=e.acquisition?parseInt(e.acquisition):void 0;let m=[];if(!(null==n?void 0:n.images))throw Error("Well .zattrs missing images");if(!(t.store instanceof x))throw Error("Store must be an HTTPStore to open well.");const[u,d]=t.store.url.split("/").filter(Boolean).slice(-2);let{images:p}=n;const f=p.flatMap((e=>e.acquisition?[e.acquisition]:[]));if(f.length>1){const e=t.store.url.replace(`${u}/${d}`,""),n=await h(new x(e)),o=await n.attrs.asObject();m=null!=(r=null==(a=null==o?void 0:o.plate)?void 0:a.acquisitions)?r:[],c&&f.includes(c)&&(p=p.filter((e=>e.acquisition===c)))}const g=p.map((e=>e.path)),y=Math.ceil(Math.sqrt(g.length)),w=Math.ceil(g.length/y),b=await t.getItem(g[0]).then((e=>e.attrs.asObject()));if(!("omero"in b))throw Error("Path for image is not valid.");let v=b.multiscales[0].datasets[0].path;const _=g.map((e=>t.getItem(Ae(e,v)))),P=await Promise.all(_),A=ze(b.multiscales),S=ke(b.omero,A),I=Ie(P[0]),C=Pe(w).flatMap((e=>Pe(y).map((t=>{const n=t+e*y;return{name:String(n),row:e,col:t,loader:new E(P[n],A,I)}})))),O=s(i({loaders:C},S),{axis_labels:A,loader:[C[0].loader],model_matrix:Ce(e.model_matrix),defaults:{selection:S.defaultSelection,colormap:null!=(o=e.colormap)?o:"",opacity:null!=(l=e.opacity)?l:1},name:`Well ${u}${d}`});return m.length>0&&(O.acquisitions=m,O.acquisitionId=c||-1),O.rows=w,O.columns=y,O.onClick=n=>{let a=n.gridCoord;if(!a)return;const{row:r,column:o}=a;let l;if(t.store instanceof x&&!isNaN(r)&&!isNaN(o)){const e=r*y+o;l=Ae(t.store.url,g[e])}e.onClick?(delete n.layer,n.imageSource=l,e.onClick(n)):l&&window.open(window.location.origin+window.location.pathname+"?source="+l)},O}(e,n,t.well);if("omero"in t)return async function(e,t,n){var a;const{name:r,opacity:o=1,colormap:l=""}=e,s=await ve(t,n.multiscales),c=ze(n.multiscales),m=ke(n.omero,c),u=Ie(s[0]),d=s.map((e=>new E(e,c,u)));return i({loader:d,axis_labels:c,name:null!=(a=m.name)?a:r,model_matrix:Ce(e.model_matrix),defaults:{selection:m.defaultSelection,colormap:l,opacity:o}},m)}(e,n,t);if(0===Object.keys(t).length&&n.store instanceof x){const t=n.store.url.slice(0,n.store.url.lastIndexOf("/")),a=await h(new x(t)),r=await a.attrs.asObject();if("plate"in r)return Oe(e,a,r.plate)}if(!("multiscales"in t))throw Error("Group is missing multiscales specification.");a=await ve(n,t.multiscales),e.axis_labels||(e.axis_labels=t.multiscales[0].axes)}else a=[n];const r=function(e,t){t&&t.length==e.shape.length||(t=e.shape.slice(0,-2).map(((e,t)=>""+t)).concat(["y","x"]));return t}(a[0],e.axis_labels),o=Ie(a[0]),l=a.map((e=>new E(e,r,o))),[c]=l,m="Float32"===c.dtype?1:v[c.dtype].max;if("channel_axis"in e||r.includes("c"))return(e=e).channel_axis=null!=(t=e.channel_axis)?t:r.indexOf("c"),function(e,t,n){const{names:a,channel_axis:r,name:o,model_matrix:l,opacity:i=1,colormap:s=""}=e;let{contrast_limits:c,visibilities:m,colors:u}=e;const d=t[0].shape[r];for(const p of[c,m,a,u])if(p&&p.length!==d){const e=Object.keys({channelProp:p})[0];throw Error(`channel_axis is length ${d} and provided channel_axis property ${e} is different size.`)}if(m||(m=d<=6?Array(d).fill(!0):[...Array(6).fill(!0),...Array(d-6).fill(!1)]),!u)if(1==d)u=[ye.white];else if(2==d)u=we;else if(3===d)u=xe;else if(d<=6)u=Ee.slice(0,d);else{u=Array(d).fill(ye.white);const e=m.flatMap(((e,t)=>e?t:[]));for(const[t,n]of e.entries())u[n]=Ee[t]}return{loader:t,name:o,channel_axis:Number(r),colors:u,names:null!=a?a:Pe(d).map((e=>`channel_${e}`)),contrast_limits:null!=c?c:Array(d).fill([0,n]),visibilities:m,model_matrix:Ce(e.model_matrix),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:s,opacity:i},axis_labels:t[0].labels}}(e,l,m);if(2===c.shape.length||!("channel_axis"in e))return function(e,t,n){const{color:a,contrast_limits:r,visibility:o,name:l,colormap:i="",opacity:s=1}=e;return{loader:t,name:l,channel_axis:null,colors:[null!=a?a:ye.white],names:["channel_0"],contrast_limits:[null!=r?r:[0,n]],visibilities:[null==o||o],model_matrix:Ce(e.model_matrix),defaults:{selection:Array(t[0].shape.length).fill(0),colormap:i,opacity:s},axis_labels:t[0].labels}}(e,l,m);throw Error("Failed to load image.")},initLayerStateFromSource:Fe});const Me=A([]),$e=A({zoom:0,target:[0,0,0],default:!0}),Le=S(Me),Ve=C((e=>A(s(i({},Fe(e)),{id:e.id}))),((e,t)=>e.id===t.id)),Re=A((e=>{const t=e(Le);if(0===t.length)return[];const n=t.map((t=>Ve(e(t))));return e(I(n))}));function Ne({layers:e}){var t,n;const[a,r]=z($e),o=F.exports.useRef(null);if(o.current&&(null==a?void 0:a.default)&&(null==(n=null==(t=e[0])?void 0:t.props)?void 0:n.loader)){const{deck:t}=o.current,{width:n,height:a,maxZoom:l}=function(e){const{loader:t,rows:n,columns:a}=e,[r,o]=Array.isArray(t)?[t[0],t.length]:[t,0],l=Se(r.shape);let[i,s]=r.shape.slice(l?-3:-2);if(n&&a){const e=5;i=(i+e)*n,s=(s+e)*a}return{height:i,width:s,maxZoom:o}}(e[0].props),i=t.width<400?10:t.width<600?30:50,{zoom:s,target:c}=function([e,t],[n,a],r,o){const l=(n-2*o)/e,i=(a-2*o)/t;return{zoom:Math.min(r,Math.log2(Math.min(l,i))),target:[e/2,t/2,0]}}([n,a],[t.width,t.height],l,i);r({zoom:s,target:c})}return k.createElement(j,{ref:o,layers:e,viewState:a,onViewStateChange:e=>r(e.viewState),views:[new M({id:"ortho",controller:!0})]})}function Te(){const e=O(Re).map((e=>e.on?new e.Layer(e.layerProps):null));return k.createElement(Ne,{layers:e})}function Be({sourceAtom:e,layerAtom:t}){const n=O(e),[a,r]=z(t);return k.createElement($,{"aria-label":`toggle-layer-visibility-${n.id}`,onClick:e=>{e.stopPropagation(),r((e=>{const t=!e.on;return s(i({},e),{on:t})}))},style:{backgroundColor:"transparent",marginTop:"2px",color:`rgb(255, 255, 255, ${a.on?1:.5})`}},a.on?k.createElement(L,null):k.createElement(V,null))}const De=R({root:{borderBottom:"1px solid rgba(150, 150, 150, .125)",backgroundColor:"rgba(150, 150, 150, 0.25)",display:"block",padding:"0 3px",height:27,minHeight:27,overflow:"hidden",transition:"none","&$expanded":{minHeight:27}},content:{margin:0,"&$expanded":{margin:0}},expanded:{}})(N);function qe({sourceAtom:e,layerAtom:t,name:n}){const a=`layer-controller-${O(e).id}`;return k.createElement(De,{"aria-controls":a,id:a},k.createElement("div",{style:{display:"flex",flexDirection:"row"}},k.createElement(Be,{sourceAtom:e,layerAtom:t}),k.createElement(T,{style:{marginTop:"4px",marginLeft:"5px"},variant:"body2"},n)))}function We({sourceAtom:e}){const t=O(e),{acquisitionId:n,acquisitions:a}=t;if(!a)return null;return k.createElement(k.Fragment,null,k.createElement(B,null,k.createElement(D,{fullWidth:!0,style:{fontSize:"0.7em"},onChange:e=>{let t=e.target.value;const n=new URL(window.location.href);"-1"===t?n.searchParams.delete("acquisition"):n.searchParams.set("acquisition",t),window.location.href=decodeURIComponent(n.href)},value:n},k.createElement("option",{value:"-1",key:"-1"},"Filter by Acquisition"),a.map((e=>(e=e,k.createElement("option",{value:e.id,key:e.id},"Acquisition: ",e.name)))))))}function Ue({sourceAtom:e,layerAtom:t}){const n=O(e),[a,r]=z(t),[o,l]=F.exports.useState(null),c=()=>{l(null)},{names:m}=n,u=Boolean(o),d=u?`layer-${n.id}-add-channel`:void 0;return k.createElement(k.Fragment,null,k.createElement($,{onClick:e=>{l(e.currentTarget)},"aria-describedby":d,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"},disabled:6===a.layerProps.loaderSelection.length},k.createElement(q,null)),k.createElement(W,{id:d,open:u,anchorEl:o,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},k.createElement(U,{style:{padding:"0px 4px",marginBottom:4,width:"8em"}},k.createElement(T,{variant:"caption"},"selection: "),k.createElement(G,null),k.createElement(D,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${n.id}-channel-select`,onChange:e=>{const{defaults:{selection:t},channel_axis:a,colors:o,contrast_limits:l}=n;c();const m=+e.target.value,u=[...t];a&&(u[a]=m),r((e=>{const{layerProps:t}=e,n=[...t.loaderSelection,u],a=[...t.colorValues,_e(o[m])],r=[...t.sliderValues,l[m]],c=[...r],d=[...t.channelIsOn,!0];return s(i({},e),{layerProps:s(i({},t),{loaderSelection:n,colorValues:a,sliderValues:r,contrastLimits:c,channelIsOn:d})})}))}},k.createElement("option",{"aria-label":"None",value:""},"None"),m.map(((e,t)=>k.createElement("option",{value:t,key:e},e)))))))}const Ge=R({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(H);function He({layerAtom:e}){const[t,n]=z(e);return k.createElement(Ge,{value:t.layerProps.opacity,onChange:(e,t)=>{const a=t;n((e=>s(i({},e),{layerProps:s(i({},e.layerProps),{opacity:a})})))},min:0,max:1,step:.01})}const Je=R({root:{width:"5.5em",fontSize:"0.7em"}})(J);function Ze({sourceAtom:e,layerAtom:t,axisIndex:n,max:a}){const r=O(e),[o,l]=z(t),[c,m]=F.exports.useState(null),u=Boolean(c),d=u?`${n}-index-${r.id}-options`:void 0,p=o.layerProps.loaderSelection[0]?o.layerProps.loaderSelection[0][n]:1;return k.createElement(k.Fragment,null,k.createElement($,{onClick:e=>{m(e.currentTarget)},"aria-describedby":d,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"}},k.createElement(Z,null)),k.createElement(W,{id:d,open:u,anchorEl:c,onClose:()=>{m(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},k.createElement(U,{style:{padding:"0px 4px",marginBottom:4}},k.createElement(T,{variant:"caption"},"Index:"),k.createElement(G,null),k.createElement(Je,{value:p,onChange:e=>{let t=+e.target.value;t<0&&(t=0),t>a&&(t=a),l((e=>{let a=i({},e.layerProps);return a.loaderSelection=a.loaderSelection.map((e=>{let a=[...e];return a[n]=t,a})),s(i({},e),{layerProps:a})}))},type:"number",id:"max",fullWidth:!1}),k.createElement(G,null))))}const Xe=R({root:{color:"white",padding:"10px 0px 5px 0px",marginRight:"5px"},active:{boxshadow:"0px 0px 0px 8px rgba(158, 158, 158, 0.16)"}})(H);function Ye({sourceAtom:e,layerAtom:t,axisIndex:n,max:a}){const[r,o]=z(t),l=O(e),{axis_labels:c}=l;let m=c[n];"t"!==m&&"z"!==m||(m=m.toUpperCase());const[u,d]=F.exports.useState(0);F.exports.useEffect((()=>{d(r.layerProps.loaderSelection[0]?r.layerProps.loaderSelection[0][n]:1)}),[r.layerProps.loaderSelection]);return k.createElement(k.Fragment,null,k.createElement(B,null,k.createElement(B,{container:!0,justify:"space-between"},k.createElement(B,{item:!0,xs:10},k.createElement("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"}},k.createElement(T,{variant:"caption",noWrap:!0},m,": ",u,"/",a))),k.createElement(B,{item:!0,xs:1},k.createElement(Ze,{sourceAtom:e,layerAtom:t,axisIndex:n,max:a}))),k.createElement(B,{container:!0,justify:"space-between"},k.createElement(B,{item:!0,xs:12},k.createElement(Xe,{value:u,onChange:(e,t)=>{d(t)},onChangeCommitted:()=>{o((e=>{let t=i({},e.layerProps);return t.loaderSelection=t.loaderSelection.map((e=>{let t=[...e];return t[n]=u,t})),s(i({},e),{layerProps:t})}))},min:0,max:a,step:1})))),k.createElement(G,null))}function Ke({sourceAtom:e,layerAtom:t}){const n=O(e),{axis_labels:a,channel_axis:r,loader:o}=n,l=a.slice(0,-2).map(((e,t)=>[e,t,o[0].shape[t]])).filter((e=>e[1]!==r&&e[2]>1)).map((([n,a,r])=>k.createElement(Ye,{key:n,sourceAtom:e,layerAtom:t,axisIndex:a,max:r-1})));return 0===l.length?null:k.createElement(k.Fragment,null,k.createElement(B,null,l),k.createElement(G,null))}const Qe=X((()=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"2px"},button:{padding:"3px",width:"16px",height:"16px"}}))),et=Object.entries(ye).map((([e,t])=>[e,_e(t)]));function tt({handleChange:e}){const t=Qe();return k.createElement("div",{className:t.container,"aria-label":"color-swatch"},et.map((([n,a])=>k.createElement($,{className:t.button,key:n,onClick:()=>e(a)},k.createElement(Y,{fontSize:"small",style:{color:`rgb(${a})`}})))))}const nt=R({root:{width:"5.5em",fontSize:"0.7em"}})(J);function at({sourceAtom:e,layerAtom:t,channelIndex:n}){const a=O(e),[r,o]=z(t),[l,c]=F.exports.useState(null),{channel_axis:m,names:u}=a,d=e=>{const t=e.target.id;let a=+e.target.value;a<0&&(a=0),o((e=>{const r=[...e.layerProps.contrastLimits],o=[...e.layerProps.sliderValues],[l,c]=r[n],[m,u]=o[n],[d,p]="min"===t?[a,c]:[l,a];return d>m&&(o[n]=[d,u]),p<u&&(o[n]=[m,p]),r[n]=[d,p],s(i({},e),{layerProps:s(i({},e.layerProps),{sliderValues:o,contrastLimits:r})})}))},p=Boolean(l),h=p?`channel-${n}-${a.name}-options`:void 0,[f,g]=r.layerProps.contrastLimits[n];return k.createElement(k.Fragment,null,k.createElement($,{onClick:e=>{c(e.currentTarget)},"aria-describedby":h,style:{backgroundColor:"transparent",padding:0,zIndex:2,cursor:"pointer"}},k.createElement(Z,null)),k.createElement(W,{id:h,open:p,anchorEl:l,onClose:()=>{c(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},k.createElement(U,{style:{padding:"0px 4px",marginBottom:4}},k.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},k.createElement(T,{variant:"caption"},"remove:"),k.createElement($,{onClick:()=>{o((e=>{const{layerProps:t}=e,a=[...t.colorValues],r=[...t.sliderValues],o=[...t.contrastLimits],l=[...t.loaderSelection],c=[...t.channelIsOn];return a.splice(n,1),r.splice(n,1),o.splice(n,1),l.splice(n,1),c.splice(n,1),s(i({},e),{layerProps:s(i({},t),{colorValues:a,sliderValues:r,loaderSelection:l,channelIsOn:c,contrastLimits:o})})}))}},k.createElement(K,null))),k.createElement(G,null),k.createElement(T,{variant:"caption"},"selection:"),k.createElement(G,null),k.createElement(D,{fullWidth:!0,style:{fontSize:"0.7em"},id:`layer-${a.name}-channel-select`,onChange:e=>{o((t=>{const a=[...t.layerProps.loaderSelection],r=[...a[n]];return Number.isInteger(m)&&(r[m]=+e.target.value,a[n]=r),s(i({},t),{layerProps:s(i({},t.layerProps),{loaderSelection:a})})}))},value:r.layerProps.loaderSelection[n][m]},u.map(((e,t)=>k.createElement("option",{value:t,key:e},"(",t,") ",e)))),k.createElement(G,null),k.createElement(T,{variant:"caption"},"contrast limits:"),k.createElement(G,null),k.createElement(nt,{value:f,onChange:d,type:"number",id:"min",fullWidth:!1}),k.createElement(nt,{value:g,onChange:d,type:"number",id:"max",fullWidth:!1}),k.createElement(G,null),k.createElement(T,{variant:"caption"},"color:"),k.createElement(G,null),k.createElement("div",{style:{display:"flex",justifyContent:"center"}},k.createElement(tt,{handleChange:e=>{o((t=>{const a=[...t.layerProps.colorValues];return a[n]=e,s(i({},t),{layerProps:s(i({},t.layerProps),{colorValues:a})})}))}})))))}function rt({sourceAtom:e,layerAtom:t,channelIndex:n}){const a=O(e),[r,o]=z(t),{sliderValues:l,colorValues:c,contrastLimits:m,channelIsOn:u,colormap:d,loaderSelection:p}=r.layerProps,h=[...l[n]],f=`rgb(${d?[255,255,255]:c[n]})`,g=u[n],[y,w]=m[n],{channel_axis:x,names:E}=a,b=p[n],v=E[Number.isInteger(x)?b[x]:0];return k.createElement(k.Fragment,null,k.createElement(B,{container:!0,justify:"space-between",wrap:"nowrap"},k.createElement(B,{item:!0,xs:10},k.createElement("div",{style:{width:165,overflow:"hidden",textOverflow:"ellipsis"}},k.createElement(T,{variant:"caption",noWrap:!0},v))),k.createElement(B,{item:!0,xs:1},k.createElement(at,{sourceAtom:e,layerAtom:t,channelIndex:n}))),k.createElement(B,{container:!0,justify:"space-between"},k.createElement(B,{item:!0,xs:2},k.createElement($,{style:{color:f,backgroundColor:"transparent",padding:0,zIndex:2},onClick:()=>{o((e=>{const t=[...e.layerProps.channelIsOn];return t[n]=!t[n],s(i({},e),{layerProps:s(i({},e.layerProps),{channelIsOn:t})})}))}},g?k.createElement(Q,null):k.createElement(ee,null))),k.createElement(B,{item:!0,xs:10},k.createElement(H,{value:h,onChange:(e,t)=>{o((e=>{const a=[...e.layerProps.sliderValues];return a[n]=t,s(i({},e),{layerProps:s(i({},e.layerProps),{sliderValues:a})})}))},min:y,max:w,step:.01,style:{padding:"10px 0px 5px 0px",color:f}}))))}const ot=R({root:{padding:"2px 5px",borderLeft:"1px solid rgba(150, 150, 150, .2)",borderRight:"1px solid rgba(150, 150, 150, .2)"}})(te);function lt({sourceAtom:e,layerAtom:t}){const n=O(t).layerProps.loaderSelection.length;return k.createElement(ot,null,k.createElement(B,{container:!0,direction:"column"},k.createElement(We,{sourceAtom:e,layerAtom:t}),k.createElement(B,null,k.createElement(B,{container:!0,justify:"space-between"},k.createElement(B,{item:!0,xs:3},k.createElement(T,{variant:"caption"},"opacity:")),k.createElement(B,{item:!0,xs:8},k.createElement(He,{sourceAtom:e,layerAtom:t})))),k.createElement(G,null),k.createElement(Ke,{sourceAtom:e,layerAtom:t}),k.createElement(B,{container:!0,justify:"space-between"},k.createElement(B,{item:!0,xs:3},k.createElement(T,{variant:"caption"},"channels:")),k.createElement(B,{item:!0,xs:1},k.createElement(Ue,{sourceAtom:e,layerAtom:t}))),k.createElement(G,null),k.createElement(B,null,Pe(n).map((n=>k.createElement(rt,{sourceAtom:e,layerAtom:t,channelIndex:n,key:n}))))))}const it=R({root:{borderBottom:"1px solid rgba(150, 150, 150, .2)",width:200,boxshadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:0,padding:0}},expanded:{padding:1}})(ne);function st({sourceAtom:e}){const t=O(e),n=Ve(t),{name:a=""}=t;return k.createElement(it,{defaultExpanded:!0},k.createElement(qe,{sourceAtom:e,layerAtom:n,name:a}),k.createElement(lt,{sourceAtom:e,layerAtom:n}))}const ct=X({root:{zIndex:1,position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.7)",borderRadius:"5px",left:"5px",top:"5px"},scroll:{maxHeight:500,overflowX:"hidden",overflowY:"scroll","&::-webkit-scrollbar":{display:"none",background:"transparent"},scrollbarWidth:"none",flexDirection:"column"}});function mt(){const e=O(Le),[t,n]=F.exports.useReducer((e=>!e),!1),a=ct();return k.createElement("div",{className:a.root,style:{padding:`0px 5px ${t?0:5}px 5px`}},k.createElement(B,{container:!0,direction:"column",alignItems:"flex-start"},k.createElement($,{style:{backgroundColor:"transparent",padding:0},onClick:n},t?k.createElement(q,null):k.createElement(K,null)),k.createElement("div",{className:a.scroll,style:{display:t?"none":"flex"}},e.map((e=>k.createElement(st,{key:`${e}`,sourceAtom:e}))))))}function ut(){const e=ae(Me),t=ae($e);async function n(t){const{createSourceData:n}=await de((()=>Promise.resolve().then((function(){return je}))),void 0),a=Math.random().toString(36).slice(2),r=await n(t);e((e=>(r.name||(r.name=`image_${Object.keys(e).length}`),[...e,i({id:a},r)])))}return F.exports.useEffect((()=>{const e=new URLSearchParams(window.location.search);if(e.has("source")){const t={};for(const[n,o]of e)t[n]=o;t.source=decodeURIComponent(t.source),n(t);const a=new URL(window.location.href);a.searchParams.set("source",t.source);const r=decodeURIComponent(a.toString());window.location.href!==r&&window.history.pushState(null,"",r)}}),[]),F.exports.useEffect((()=>{window.self!==window.top&&async function(){const{default:e}=await de((()=>import("./index.ccefb928.js").then((function(e){return e.i}))),[]);(await e.setupRPC({name:"vizarr",description:"A minimal, purely client-side program for viewing Zarr-based images with Viv & ImJoy.",version:"0.3.0"})).export({add_image:async e=>n(e),set_view_state:async e=>t(e)})}()}),[]),k.createElement(k.Fragment,null,k.createElement(mt,null),k.createElement(Te,null))}var dt=re({palette:{type:"dark",primary:oe,secondary:oe},props:{MuiButton:{size:"small"},MuiButtonBase:{disableRipple:!0},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiInputLabel:{margin:"dense"},MuiOutlinedInput:{margin:"dense"}},overrides:{MuiSlider:{thumb:{"&:focus, &:hover":{boxShadow:"none"},height:11,width:5,borderRadius:"15%",marginLeft:-1}},MuiInput:{underline:{"&&&&:hover:before":{borderBottom:"1px solid #fff"}}},MuiPaper:{root:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},MuiSvgIcon:{root:{width:"0.7em",height:"0.7em"}}}});const pt=new Map;function ht(e,t){le(e,(()=>{if(!pt.has(e)){const n=t().then((e=>e.default)).catch((t=>{throw pt.delete(e),t}));pt.set(e,n)}return pt.get(e)}))}ht("lz4",(()=>de((()=>import("./lz4.90bd37fe.js")),["lz4.90bd37fe.js","utils-6b0080f1.f4680ab2.js"]))),ht("gzip",(()=>de((()=>import("./gzip.2d512667.js")),["gzip.2d512667.js","pako.esm-9240ff4b.6c52ac68.js"]))),ht("zlib",(()=>de((()=>import("./zlib.3b3d5619.js")),["zlib.3b3d5619.js","pako.esm-9240ff4b.6c52ac68.js"]))),ht("zstd",(()=>de((()=>import("./zstd.73353642.js")),["zstd.73353642.js","utils-6b0080f1.f4680ab2.js"]))),ht("blosc",(()=>de((()=>import("./blosc.0f249b18.js")),["blosc.0f249b18.js","utils-6b0080f1.f4680ab2.js"]))),console.log("vizarr v0.3.0: https://github.com/hms-dbmi/vizarr"),ie.render(k.createElement(se,{theme:dt},k.createElement(ce,null,k.createElement(ut,null))),document.getElementById("root"));
